$(document).ready(function(){var script=['/public/assets/js/backend/area.js','/public/assets/js/backend/categories.js',];var t=$(location).attr("href");var sz_CurrentHost=t.split("/")[0]+"//"+t.split("/")[2];jQuery(document.body).on('change','.imgInp',function(event){var me=$(this);if(this.files&&this.files[0]){var reader=new FileReader();reader.onload=function(e){me.closest('div').find('img').attr('src',e.target.result);}
reader.readAsDataURL(this.files[0]);}});$.each(script,function(key,script){$("body").append('<script type="text/javascript" src="'+script+'"></script>');});$('input[name=permalink]').focus(function(){var value=$("input[name=name]").val();if(value==''){alert('Bạn chưa nhập tên');return false;}var sz_alias=convert(value);$(this).val(sz_alias);});function convert(str){str=str.toLowerCase();str=str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a");str=str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e");str=str.replace(/ì|í|ị|ỉ|ĩ/g,"i");str=str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o");str=str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u");str=str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y");str=str.replace(/đ/g,"d");str=str.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g,"-");str=str.replace(/-+-/g,"-");str=str.replace(/^\-+|\-+$/g,"");str=str.replace(/–/g,"");return str;};$('.changeAjax').change(function(){var id=$(this).attr('data-id');var tbl=$('.tbl').val();var field=$(this).attr('data-field');if($(this).attr('type')=='checkbox'){if($(this).is(':checked')){var value=true;}else{var value=false;}}else var value=$(this).val();var arrData={id:id,tbl:tbl,field:field,val:value,};$.ajax({type:'post',url:sz_CurrentHost+'/api/common',data:{func:'changeValue',arrData:arrData,},dataType:'json',success:function(res){},});});$(document).on('click','.add-section',function(){var index=$('.block-clone').length;var parent=$(this).closest('section');var objectClone=parent.find('.block-clone').last().clone();objectClone.find("input[type=text]").removeAttr('value');objectClone.find("input[type=number]").removeAttr('value');objectClone.find("input[type=radio]").removeAttr('checked');objectClone.find("input[name^=sectionActive]").attr('name','sectionActive['+index+']').attr('checked',true);objectClone.find("input[name^=sectionShowTab]").attr('name','sectionShowTab['+index+']').attr('checked',true);var htmlClone=objectClone.wrap("<div/>").parent().html();var textareaId='id_'+jQuery.now();var textAreaHtml='<div class="form-group"><div class="col-xs-12 col-sm-12 no-padding"><label class="col-xs-12 col-sm-1 control-label text-left">Nội dung</label> <div class="col-xs-12 col-sm-11 no-padding"> <textarea name="sectionDetail[]" class="tinymce" id="'+textareaId+'"></textarea></div></div></div>';var html=htmlClone+textAreaHtml;$('.block-section').append('<div class="tile-body block-form-title-body" style="display: block;">').append(htmlClone).append(textAreaHtml).append('</div>');$(this).before('<div class="tile-body block-form-title-body" style="display: block;">'+html+'</div>');AddRemoveTinyMce(textareaId);});$('.add-img').click(function(){var countBlockImg=$('.block-img').length;html=$('.block-img').last().clone();html.find(".imgUpload").attr('src','');html.find("a.iframe-btn").attr('href','/public/filemanager/dialog.php?type=1&field_id=img-'+countBlockImg);html.find(".urlHide").attr('id','img-'+countBlockImg);html.find("#img-"+countBlockImg).val('');$(this).closest('.block-form-title-body').find('.block-img').last().after(html);});$('.addBlockRootApartmentType').on('click',function(){var rootIndex=$('.blockRootApartmentType').length;var html='<div class="tile-body block-form-title-body blockRootApartmentType" root-index="'+rootIndex+'" style="display: block; border-bottom: dotted 2px #ccc;">'+'<div class="col-xs-12 col-sm-12 no-padding">'+'<label class="col-xs-12 col-sm-2 control-label text-left">Ảnh gốc</label>'+'<div class="col-xs-12 col-sm-10 no-padding">'+'<a href="/public/filemanager/dialog.php?type=1&field_id=rootApartmentTypeImg-'+rootIndex+'" class="btn btn-primary btn-sm iframe-btn" type="button">Chọn ảnh</a>'+'<a class="btn btn-danger btn-sm delRootApartmentType" type="button">Xóa khối</a>'+'<img class="imgUpload" src="" alt="">'+'<input type="hidden" class="form-control urlHide" id="rootApartmentTypeImg-'+rootIndex+'" name="apartmentType['+rootIndex+'][rootImg]" value="">'+'</div>'+'</div>'+'<div class="col-xs-12 col-sm-12 no-padding blockChildApartmentType">'+'<div class="col-xs-12 col-sm-2 control-label text-left">'+'<label class="col-xs-12 col-sm-12 control-label text-left">Ảnh con</label>'+'<button type="button" class="btn btn-primary btn-sm addChildApartmentTypeImg">Thêm ảnh con</button>'+'</div>'+'<div class="col-xs-12 col-sm-10 no-padding childApartmentTypeImg">'+'</div>'+'</div>'+'<div class="clearfix"></div>'+'<br>'+'</div>';$(this).before(html);});$(document.body).on("click",".addChildApartmentTypeImg",function(){var rootIndex=$(this).closest('.blockRootApartmentType').attr('root-index');var ChildIndex=$(this).closest('.blockChildApartmentType').find('.indexOfChildImg').length;var html='<div class="col-xs-12 col-md-4 col-sm-4">'+'<a href="/public/filemanager/dialog.php?type=1&field_id=childApartmentTypeImg-'+rootIndex+'-'+ChildIndex+'" class="btn btn-primary btn-sm iframe-btn" type="button">Thêm</a>'+'<a class="btn btn-danger btn-sm delChildImg" type="button">Xóa</a>'+'<img class="imgUpload" src="" alt="">'+'<input type="hidden" class="form-control urlHide indexOfChildImg" id="childApartmentTypeImg-'+rootIndex+'-'+ChildIndex+'" name="apartmentType['+rootIndex+'][img][]" value="">'+'<textarea placeholder="Tên ảnh" name="apartmentType['+rootIndex+'][name][]"></textarea>'+'<textarea placeholder="Tọa độ ảnh" name="apartmentType['+rootIndex+'][map][]"></textarea>'+'</div>';$(this).closest('.blockChildApartmentType').find('.childApartmentTypeImg').append(html);});$(document.body).on("click",".delChildImg",function(){if(confirm("Bạn có muốn xóa ảnh con này?")){$(this).closest('div').remove();}});$(document.body).on("click",".delRootApartmentType",function(){if(confirm("Xóa toàn bộ khối này sẽ xóa toàn bộ các ảnh con trong đó. Bạn có muốn tiếp tục?")){$(this).closest('.blockRootApartmentType').remove();}});$('.load-areas').change(function(){var parentId=$(this).val();var parentType=$(this).attr('id');var option='<option value="">Quận/Huyện</option>';if(parentId!=''){$.ajax({type:'post',url:sz_CurrentHost+'/api/common',data:{func:'loadAreas',parentId:parentId,},dataType:'json',success:function(data){$.each(data.areas,function(i,item){option+='<option value="'+item._id.$id+'">'+item.name+'</option>';});if(parentType=='city')$('#district').html(option);else $('#ward').html(option);$('#region').val(data.region);}});}else{$('#district').html(option);}});$('.loadBuilding').change(function(){var projectId=$(this).val();var option='<option value="">Chọn tòa</option>';$('#building').html(option);if(projectId!=0){$.ajax({type:'post',url:sz_CurrentHost+'/api/common',data:{func:'loadBuilding',projectId:projectId,},dataType:'json',success:function(data){$.each(data.buildings,function(i,item){option+='<option value="'+item._id.$id+'">'+item.name+'</option>';});$('#building').html(option);}});}else{$('#building').html(option);}});$('.changeSttApartment').click(function(){var me=$(this);var apartment=me.attr('data-apartment');var building=$('#list-apartment').attr('data-building');$.ajax({type:'post',url:sz_CurrentHost+'/api/common',data:{func:'changeStatusApartment',apartment:apartment,building:building},dataType:'json',success:function(data){if(data.success==0){alert(data.alert);}else{if(me.hasClass("apartmentBooking")){me.removeClass('apartmentBooking').addClass('apartmentOrder');}else if(me.hasClass("apartmentOrder")){me.removeClass('apartmentOrder').addClass('apartmentSell');}else if(me.hasClass("apartmentSell")){me.removeClass('apartmentSell').addClass('apartmentEmpty');}else if(me.hasClass("apartmentEmpty")){me.removeClass('apartmentEmpty').addClass('apartmentNormal');}else if(me.hasClass("apartmentNormal")){me.removeClass('apartmentNormal').addClass('apartmentBooking');}else{me.addClass('apartmentBooking');}}}});});$('.iframe-btn').fancybox({'width':900,'height':768,'type':'iframe','autoDimensions':false,'autoSize':false,'autoScale':false,'transitionIn':'none','transitionOut':'none',helpers:{overlay:{locked:false}},'afterClose':function(){var $self=$(this.element);var url=$self.closest('div').find('.urlHide').val();$self.closest('div').find('.imgUpload').attr('src',url);}});function applyMCE(){tinyMCE.init({mode:"textareas",editor_selector:"tinymce",theme:"modern",width:'100%',height:300,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars insertdatetime media nonbreaking","table contextmenu directionality emoticons paste textcolor responsivefilemanager code fullscreen"],toolbar1:"undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | styleselect",toolbar2:"| responsivefilemanager | link unlink anchor | image media | forecolor backcolor  | print preview code fullscreen | fontsizeselect",fontsize_formats:'8pt 10pt 12pt 14pt 18pt 24pt 36pt',image_advtab:true,relative_urls:false,remove_script_host:false,forced_root_block:"",force_br_newlines:false,force_p_newlines:true,entity_encoding:"raw",formats:{bold:{inline:'b'},italic:{inline:'i'}},external_filemanager_path:"/public/filemanager/",filemanager_title:"Responsive Filemanager",external_plugins:{"filemanager":"/public/filemanager/plugin.min.js"}});}function AddRemoveTinyMce(editorId){if(tinyMCE.get(editorId)){tinyMCE.EditorManager.execCommand('mceFocus',false,editorId);tinyMCE.EditorManager.execCommand('mceRemoveEditor',true,editorId);}else{tinymce.EditorManager.execCommand('mceAddEditor',false,editorId);}}applyMCE();});